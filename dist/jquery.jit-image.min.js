/*! jQuery JIT image - v1.5.0 - build 27 - 2018-12-14
* https://github.com/DeuxHuitHuit/jQuery-jit-image
* Copyright (c) 2018 Deux Huit Huit (https://deuxhuithuit.com/);
* License MIT %> */

!function(g,t,e,i){"use strict";g.fn.on=g.fn.on||g.fn.bind,g.fn.off=g.fn.off||g.fn.unbind;var a=g(window),n=g(),m="jitImageOptions",d=function(t){return g.isFunction(t)?t.call(this):t};e=e||"data-src-format",t=t||"img["+d(e)+"]";var r,o,h,l,u,c,v=(r=[],h=o=0,l=g.now(),u=function(){var t=function(){return!!r.length&&(o<r[0].limit||!o)};if(!t()&&0<o&&l<g.now()-100){var i=[];g.each(r,function(t,e){!e.elem.closest(document).length?o=Math.max(0,o-1):i.push(e)}),r=i,l=g.now()}for(;t();){var e=r.shift();o++,e.update()}h=0},{push:function(i){var a=!1;g.each(r,function(t,e){if(e.elem.is(i.elem))return r[t]=i,a=!0}),a||r.push(i),c()},done:function(t,e){0<o&&o--,c()},check:c=function(){h||(h=setTimeout(u,0))},count:function(){return r.length},active:function(){return o},queue:function(){return r}}),f=function(t){return t+t%2},s=function(t){var e={width:~~t.container.width(),height:~~t.container.height()};return t.forceEvenSize&&(e.width=f(e.width),e.height=f(e.height)),e},w=function(a,n,t,r){if(a&&n){r.forceCssResize&&n.width?a.attr("width",n.width).width(n.width):a.removeAttr("width").width(""),r.forceCssResize&&n.height?a.attr("height",n.height).height(n.height):a.removeAttr("height").height("");var o=function(){return a.off("load.jitImage").off("error.jitImage")},e=function(i){return function(t){o();var e=[n,t,i];r.parallelLoadingLimit&&v.done(a,e),g.isFunction(r.load)&&r.load.apply(a,e),a.trigger("loaded.jitImage",e)}};if(t&&a.attr("src")!==t)return o().on("load.jitImage",e(!1)).on("error.jitImage",e(!0)),a.attr("src",t),!0}return!1},p=function(t,e){var i=t.attr(d(e.dataAttributeRatio)),a=parseFloat(i);return{isEnabled:!!i&&0<a,imageRatio:a}},b=function(t,a,n){var r=t.attr(d(a.dataAttribute)),o=p(t,a),h={isValid:!1,width:!1,height:!1},l={url:r,height:!1,width:!1,formatted:!1};if(r){if(!a.bypassDefaultFormat){if(g.each(["width","height"],function(t,e){var i=a[e+"Pattern"];l[e]=i.test(r)}),l.width&&l.height&&o.isEnabled&&0<n.width&&0<n.height){var e=n.width/n.height;h.width=o.imageRatio>=e,h.height=!h.width,h.isValid=!0}g.each(["width","height"],function(t,e){var i=a[e+"Pattern"];l[e]&&void 0!==n[e]&&(r=o.isEnabled&&h.isValid&&h[e]?r.replace(i,"0"):r.replace(i,~~(n[e]*a.devicePixelRatio)))}),l.url=r,l.formatted=l.width||l.height}g.isFunction(a.format)&&a.format.call(t,l,a,n)}return l},j=function(t,e){var i,a,n,r,o=!1,h=!1;if(e&&t){var l=e.size(e),u=!e.fetchSmallerImages&&e.previousSize(t,e),d=b(t,e,l),c=!!d&&!!d.url,f=!!l&&!!d&&(!d.width||0<l.width)&&(!d.height||0<l.height);if(c&&f){if(!e.fetchSmallerImages){p(t,e);var s=(n=l,r=u,Math.ceil(n.width/n.height*100)!==Math.ceil(r.width/r.height*100));(a=u,(i=l).width<=a.width&&i.height<=a.height)&&!s?h=!0:t.data(m).prev=g.extend({},l)}h?(o=!1,g.isFunction(e.aborted)&&e.aborted.call(t,d,e,l)):(l.width=!!d.width&&l.width,l.height=!!d.height&&l.height,(o=e.set(t,l,d.url,e))&&g.isFunction(e.updated)&&e.updated.call(t,d,e,l))}}!o&&e.parallelLoadingLimit&&v.done(t,[null,null,!0])},I=function(){g.each(n,function(t,e){var i=g(e),a=i.data(m),n=!0,r=function(){j(i,a)};a&&(a.parallelLoadingLimit?v.push({elem:i,update:r,limit:a.parallelLoadingLimit}):(clearTimeout(a.jitTimeout),n=i.is(":visible"),S.nonVisibleDelay&&!n?a.jitTimeout=setTimeout(r,S.nonVisibleDelay):r()))}),z()},L=null,R=function(t){clearTimeout(L),L=setTimeout(I,S.eventTimeout)},S={container:null,dataAttribute:e,dataAttributeRatio:"data-jit-image-ratio",defaultSelector:t,containerDataAttribute:"data-container",size:s,set:w,widthPattern:/\$w/i,heightPattern:/\$h/i,updateEvents:"resize orientationchange",eventTimeout:50,load:null,nonVisibleDelay:1e3,forceCssResize:!0,parallelLoadingLimit:0,format:null,bypassDefaultFormat:!1,updated:null,forceEvenSize:!1,useDevicePixelRatio:!0,devicePixelRatio:1,fetchSmallerImages:!0,previousSize:function(t,e){var i=t.data(m);return i&&i.prev?i.prev:{width:0,height:0}},aborted:null},z=function(){a.one(S.updateEvents,R)};g.jitImage={remove:function(t){t.data(m,null),n=n.not(t)},defaults:S,_getSize:s,_set:w,_getUrlFromFormat:b,loader:v},g.fn.jitImage=function(u){var t=g(this);return n=n.add(t),t.each(function(t,e){var i=g(e),a=i.data(m)||{},n=g.extend({},S,a,u),r=d(n.containerDataAttribute),o=r?i.attr(r):null,h=o?i.closest(o):i.parent().length?i.parent():i;n.container=n.container?g(n.container):h,n.useDevicePixelRatio&&(n.devicePixelRatio=window.devicePixelRatio||window.webkitDevicePixelRatio||1),i.data(m,n);var l=function(){j(i,n)};n.parallelLoadingLimit?v.push({elem:i,visible:!0,update:l,limit:n.parallelLoadingLimit}):l()})},a.load(function(){S.defaultSelector&&g(S.defaultSelector).jitImage(),z()})}(jQuery,window.jitImageSelector,window.jitImageDataAttribute);
//# sourceMappingURL=jquery.jit-image.min.js.map