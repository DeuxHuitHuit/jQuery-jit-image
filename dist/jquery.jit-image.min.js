/*! jQuery JIT image - v1.4.0 - build 23 - 2016-03-04
* https://github.com/DeuxHuitHuit/jQuery-jit-image
* Copyright (c) 2016 Deux Huit Huit (https://deuxhuithuit.com/);
* Licensed  */

!function(a,b,c,d){"use strict";a.fn.on=a.fn.on||a.fn.bind,a.fn.off=a.fn.off||a.fn.unbind;var e=a(window),f=a(),g="jitImageOptions",h=function(b){return a.isFunction(b)?b.call(this):b};c=c||"data-src-format",b=b||"img["+h(c)+"]";var i=function(){var b=[],c=0,d=0,e=a.now(),f=function(){var f=function(){return!!b.length&&(c<b[0].limit||!c)};if(!f()&&c>0&&e<a.now()-100){var g=[];a.each(b,function(a,b){var d=!b.elem.closest(document).length;d?c=Math.max(0,c-1):g.push(b)}),b=g,e=a.now()}for(;f();){var h=b.shift();c++,h.update()}d=0},g=function(){d||(d=setTimeout(f,0))},h=function(c){var d=!1;a.each(b,function(a,e){return e.elem.is(c.elem)?(b[a]=c,d=!0):void 0}),d||b.push(c),g()},i=function(a,b){c>0&&c--,g()};return{push:h,done:i,check:g,count:function(){return b.length},active:function(){return c},queue:function(){return b}}}(),j=function(a){return a+a%2},k=function(a){var b={width:~~a.container.width(),height:~~a.container.height()};return a.forceEvenSize&&(b.width=j(b.width),b.height=j(b.height)),b},l=function(a,b){var c=a.data(g);return c&&c.prev?c.prev:k(b)},m=function(a,b){return a.width<=b.width&&a.height<=b.height},n=function(b,c,d,e){if(b&&c){e.forceCssResize&&c.width?b.attr("width",c.width).width(c.width):b.removeAttr("width").width(""),e.forceCssResize&&c.height?b.attr("height",c.height).height(c.height):b.removeAttr("height").height("");var f=function(){return b.off("load.jitImage").off("error.jitImage")},g=function(d){return function(g){f();var h=[c,g,d];e.parallelLoadingLimit&&i.done(b,h),a.isFunction(e.load)&&e.load.apply(b,h),b.trigger("loaded.jitImage",h)}};if(d&&b.attr("src")!==d)return f().on("load.jitImage",g(!1)).on("error.jitImage",g(!0)),b.attr("src",d),!0}return!1},o=function(b,c,e){var f=b.attr(h(c.dataAttribute)),g={url:f,height:!1,width:!1,formatted:!1};return f&&(c.bypassDefaultFormat||(a.each(["width","height"],function(a,b){var h=c[b+"Pattern"];g[b]=h.test(f),g[b]&&e[b]!==d&&(f=f.replace(h,~~(e[b]*c.devicePixelRatio)))}),g.url=f,g.formatted=g.width||g.height),a.isFunction(c.format)&&c.format.call(b,g,c,e)),g},p=function(b,c){var d=!1,e=!1;if(c&&b){var f=c.size(c),h=!c.fetchSmallerImages&&c.previousSize(b,c),j=o(b,c,f),k=!!j&&!!j.url,l=!!f&&!!j&&(!j.width||f.width>0)&&(!j.height||f.height>0);k&&l&&(c.fetchSmallerImages||(m(f,h)?e=!0:b.data(g).prev=f),e?(d=!1,a.isFunction(c.aborted)&&c.aborted.call(b,j,c,f)):(f.width=j.width?f.width:!1,f.height=j.height?f.height:!1,d=c.set(b,f,j.url,c),d&&a.isFunction(c.updated)&&c.updated.call(b,j,c,f)))}!d&&c.parallelLoadingLimit&&i.done(b,[null,null,!0])},q=function(){a.each(f,function(b,c){var d=a(c),e=d.data(g),f=!0,h=function(){p(d,e)};e&&(e.parallelLoadingLimit?i.push({elem:d,update:h,limit:e.parallelLoadingLimit}):(clearTimeout(e.jitTimeout),f=d.is(":visible"),t.nonVisibleDelay&&!f?e.jitTimeout=setTimeout(h,t.nonVisibleDelay):h()))}),u()},r=null,s=function(a){clearTimeout(r),r=setTimeout(q,t.eventTimeout)},t={container:null,dataAttribute:c,defaultSelector:b,containerDataAttribute:"data-container",size:k,set:n,widthPattern:/\$w/i,heightPattern:/\$h/i,updateEvents:"resize orientationchange",eventTimeout:50,load:null,nonVisibleDelay:1e3,forceCssResize:!0,parallelLoadingLimit:0,format:null,bypassDefaultFormat:!1,updated:null,forceEvenSize:!1,useDevicePixelRatio:!0,devicePixelRatio:1,fetchSmallerImages:!0,previousSize:l,aborted:null},u=function(){e.one(t.updateEvents,s)};a.jitImage={remove:function(a){a.data(g,null),f=f.not(a)},defaults:t,_getSize:k,_set:n,_getUrlFromFormat:o,loader:i},a.fn.jitImage=function(b){var c=a(this),d=function(c,d){var e=a(d),f=e.data(g)||{},j=a.extend({},t,f,b),k=h(j.containerDataAttribute),l=k?e.attr(k):null,m=l?e.closest(l):e.parent().length?e.parent():e;j.container=j.container?a(j.container):m,j.useDevicePixelRatio&&(j.devicePixelRatio=window.devicePixelRatio||window.webkitDevicePixelRatio||1),e.data(g,j);var n=function(){p(e,j)};j.parallelLoadingLimit?i.push({elem:e,visible:!0,update:n,limit:j.parallelLoadingLimit}):n()};return f=f.add(c),c.each(d)},e.load(function(){t.defaultSelector&&a(t.defaultSelector).jitImage(),u()})}(jQuery,window.jitImageSelector,window.jitImageDataAttribute);
//# sourceMappingURL=jquery.jit-image.min.js.map