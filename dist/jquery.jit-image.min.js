/*! jQuery JIT image - v1.2.1 - build 13 - 2014-03-13
* https://github.com/DeuxHuitHuit/jQuery-jit-image
* Copyright (c) 2014 Deux Huit Huit (http://www.deuxhuithuit.com/);
* Licensed MIT */

!function(a,b,c){"use strict";a.fn.on=a.fn.on||a.fn.bind,a.fn.off=a.fn.off||a.fn.unbind;var d=a(window),e=a(),f="jitImageOptions",g=function(b){return a.isFunction(b)?b.call(this):b};c=c||"data-src-format",b=b||"img["+g(c)+"]";var h=function(){var b=[],c=0,d=0,e=function(){for(;b.length&&(c<b[0].limit||!c);){var a=b.shift();c++,a.update()}d=0},f=function(){d||(d=setTimeout(e,0))},g=function(c){var d=!1;a.each(b,function(a,e){return e.elem.is(c.elem)?(b[a]=c,d=!0):void 0}),d||b.push(c),f()},h=function(){c>0&&c--,f()};return{push:g,done:h,check:f,count:function(){return b.length},active:function(){return c},queue:function(){return b}}}(),i=function(a){var b={width:~~a.container.width(),height:~~a.container.height()};return a.forceEvenSize&&(b.width=b.width+b.width%2,b.height=b.height+b.height%2),b},j=function(b,c,d,e,f,g){if(b&&c){e&&c.width?b.attr("width",c.width).width(c.width):b.removeAttr("width").width(""),e&&c.height?b.attr("height",c.height).height(c.height):b.removeAttr("height").height("");var i=function(){return b.off("load.jitImage").off("error.jitImage")},j=function(d){return function(e){i();var j=[c,e,d];g&&h.done(b,j),a.isFunction(f)&&f.apply(b,j),b.trigger("loaded.jitImage",j)}};if(d&&b.attr("src")!==d)return i().on("load.jitImage",j(!1)).on("error.jitImage",j(!0)),b.attr("src",d),!0}return!1},k=function(b,c,d){var e=b.attr(g(c.dataAttribute)),f={url:e,height:!1,width:!1,formatted:!1};return e&&(c.bypassDefaultFormat||(f.width=c.widthPattern.test(e),f.height=c.heightPattern.test(e),f.width&&(e=e.replace(c.widthPattern,~~d.width)),f.height&&(e=e.replace(c.heightPattern,~~d.height)),f.url=e,f.formatted=f.width||f.height),a.isFunction(c.format)&&c.format.call(b,f,c,d)),f},l=function(b,c){var d=!1;if(c&&b){var e=c.size(c),f=k(b,c,e),g=!!f&&!!f.url,i=!!e&&(e.height>0||e.width>0);g&&i&&(e.width=f.width?e.width:!1,e.height=f.height?e.height:!1,d=c.set(b,e,f.url,c.forceCssResize,c.load,c.parallelLoadingLimit),d&&a.isFunction(c.updated)&&c.updated.call(b,f,c,e))}!d&&c.parallelLoadingLimit&&h.done(b,[null,null,!0])},m=function(){a.each(e,function(b,c){var d=a(c),e=d.data(f),g=d.is(":visible"),i=function(){l(d,e)};e&&(e.parallelLoadingLimit?h.push({elem:d,visible:g,update:i,limit:e.parallelLoadingLimit}):(clearTimeout(e.jitTimeout),p.nonVisibleDelay&&!g?e.jitTimeout=setTimeout(i,p.nonVisibleDelay):i()))}),q()},n=null,o=function(){clearTimeout(n),n=setTimeout(m,p.eventTimeout)},p={container:null,dataAttribute:c,defaultSelector:b,containerDataAttribute:"data-container",size:i,set:j,widthPattern:/\$w/i,heightPattern:/\$h/i,updateEvents:"resize orientationchange",eventTimeout:50,load:null,nonVisibleDelay:1e3,forceCssResize:!0,parallelLoadingLimit:0,format:null,bypassDefaultFormat:!1,updated:null,forceEvenSize:!1},q=function(){d.one(p.updateEvents,o)};a.jitImage={remove:function(a){a.data(f,null),e=e.not(a)},defaults:p,_getSize:i,_set:j,_getUrlFromFormat:k,loader:h},a.fn.jitImage=function(b){var c=a(this),d=function(c,d){var e=a(d),i=e.data(f)||{},j=a.extend({},p,i,b),k=g(j.containerDataAttribute),m=k?e.attr(k):null,n=m?e.closest(m):e.parent().length?e.parent():e;j.container=j.container?a(j.container):n,e.data(f,j);var o=function(){l(e,j)};j.parallelLoadingLimit?h.push({elem:e,visible:!0,update:o,limit:j.parallelLoadingLimit}):o()};return e=e.add(c),c.each(d)},d.load(function(){p.defaultSelector&&a(p.defaultSelector).jitImage(),q()})}(jQuery,window.jitImageSelector,window.jitImageDataAttribute);
//# sourceMappingURL=jquery.jit-image.min.js.map